# üîß SonarCloud Troubleshooting Guide

## ‚ùå Problema: GitHub Action falhou

Se voc√™ est√° vendo erros no GitHub Actions relacionados ao SonarCloud, este guia ajudar√° a resolver.

## üêõ Erros Comuns

### 1. "SONAR_TOKEN is not configured" ou token vazio

**Erro t√≠pico:**
```
ERROR Failed to query JRE metadata: . Please check the property sonar.token or the environment variable SONAR_TOKEN.
Warning: Running this GitHub Action without SONAR_TOKEN is not recommended
```

**‚úÖ Solu√ß√£o:**

1. **Acesse SonarCloud**:
   - V√° para: https://sonarcloud.io/account/security
   - Fa√ßa login com sua conta GitHub

2. **Gere um novo token**:
   - Click em "Generate Tokens"
   - Nome: `HC-Lisp CI`
   - Expiration: `No expiration` ou `90 days`
   - Copy o token gerado

3. **Configure no GitHub**:
   - V√° para: https://github.com/HectorIFC/hc-lisp/settings/secrets/actions
   - Click "New repository secret"
   - Name: `SONAR_TOKEN`
   - Value: cole o token copiado
   - Click "Add secret"

4. **Teste a configura√ß√£o**:
   ```bash
   # Execute um novo commit para testar
   git commit --allow-empty -m "test: trigger SonarCloud analysis"
   git push origin master
   ```

### 2. "Action is deprecated" Warning

**Warning t√≠pico:**
```
Warning: This action is deprecated and will be removed in a future release. Please use the sonarqube-scan-action action instead.
```

**‚úÖ Solu√ß√£o:**
Este warning foi corrigido! O workflow agora usa:
- `SonarSource/sonarqube-scan-action@v5` (atualizado)
- `sonarqube-quality-gate-action@v1.3.0` (vers√£o est√°vel)

### 3. "Project not found" ou "Authentication failed"

**Erro t√≠pico:**
```
ERROR: Error during SonarScanner execution
ERROR: Project 'HectorIFC_hc-lisp' not found
```

**‚úÖ Solu√ß√£o:**

1. **Verifique o projeto no SonarCloud**:
   - Acesse: https://sonarcloud.io/projects
   - Procure por: `hc-lisp` ou `HectorIFC_hc-lisp`

2. **Se o projeto n√£o existe**:
   ```bash
   # Execute o setup novamente
   npm run sonarcloud:setup
   ```

3. **Importe o projeto manualmente**:
   - V√° para: https://sonarcloud.io/projects/create
   - Click "Import project from GitHub"
   - Selecione: `HectorIFC/hc-lisp`
   - Project key deve ser: `HectorIFC_hc-lisp`

### 4. "Organization not found"

**Erro t√≠pico:**
```
ERROR: Organization 'hectorifc' does not exist
```

**‚úÖ Solu√ß√£o:**

1. **Verifique sua organiza√ß√£o SonarCloud**:
   - Acesse: https://sonarcloud.io/account/organizations
   - Anote o nome exato da organiza√ß√£o

2. **Atualize o sonar-project.properties**:
   ```properties
   sonar.organization=SEU_ORG_NAME_AQUI
   ```

## üîç Verifica√ß√£o Passo a Passo

### 1. Verificar configura√ß√£o local
```bash
# Verificar arquivos de configura√ß√£o
npm run sonarcloud:verify

# Testar gera√ß√£o de coverage
npm run sonarcloud:test
```

### 2. Verificar configura√ß√£o no GitHub

**Secrets configurados:**
- V√° para: https://github.com/HectorIFC/hc-lisp/settings/secrets/actions
- Deve ter: `SONAR_TOKEN` configurado

**Workflows ativos:**
- V√° para: https://github.com/HectorIFC/hc-lisp/actions
- Verifique se o workflow "SonarCloud Analysis" aparece

### 3. Verificar configura√ß√£o no SonarCloud

**Projeto importado:**
- Acesse: https://sonarcloud.io/projects
- Procure: `hc-lisp` ou `HectorIFC_hc-lisp`

**Token ativo:**
- Acesse: https://sonarcloud.io/account/security
- Verifique se o token existe e n√£o expirou

## üöÄ Teste Completo

Ap√≥s corrigir os problemas, teste com:

```bash
# 1. Commit vazio para trigger
git commit --allow-empty -m "test: SonarCloud integration"
git push origin master

# 2. Verificar execu√ß√£o
# - GitHub Actions: https://github.com/HectorIFC/hc-lisp/actions
# - SonarCloud: https://sonarcloud.io/project/overview?id=HectorIFC_hc-lisp
```

## üìû Se ainda n√£o funcionar

### Logs √∫teis para debug:

1. **GitHub Actions logs**:
   - V√° para o workflow que falhou
   - Expanda cada step para ver logs detalhados

2. **Verificar configura√ß√£o**:
   ```bash
   # Ver configura√ß√£o atual
   cat sonar-project.properties
   
   # Verificar se coverage √© gerado
   npm run coverage:sonar
   ls -la coverage/lcov.info
   ```

3. **Teste manual do SonarScanner**:
   ```bash
   # Se tiver sonar-scanner instalado localmente
   sonar-scanner -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=SEU_TOKEN
   ```

## ‚úÖ Checklist de Solu√ß√£o

- [ ] ‚úÖ SONAR_TOKEN configurado no GitHub Secrets
- [ ] ‚úÖ Projeto importado no SonarCloud
- [ ] ‚úÖ Organization name correto em sonar-project.properties
- [ ] ‚úÖ Workflow atualizado (sem actions deprecadas)
- [ ] ‚úÖ Coverage LCOV sendo gerado (npm run coverage:sonar)
- [ ] ‚úÖ Teste realizado com commit

## üéØ Resultado Esperado

Ap√≥s a corre√ß√£o, voc√™ deve ver:

1. **GitHub Actions**: ‚úÖ Workflow "SonarCloud Analysis" passa
2. **SonarCloud**: Dashboard com m√©tricas atualizadas
3. **PRs**: Coment√°rios autom√°ticos com an√°lise

**üîó Links de verifica√ß√£o:**
- **Actions**: https://github.com/HectorIFC/hc-lisp/actions
- **SonarCloud**: https://sonarcloud.io/project/overview?id=HectorIFC_hc-lisp
